From 37e98905edef29a276d3021bf1edbcf143e98ca0 Mon Sep 17 00:00:00 2001
From: Zach Brown <zach.brown@destroystokyo.com>
Date: Sat, 19 Nov 2016 22:10:34 -0600
Subject: [PATCH] SPIGOT-2806: Backport an event fix


diff --git a/src/main/java/net/minecraft/server/Container.java b/src/main/java/net/minecraft/server/Container.java
index d39ffbe..844916f 100644
--- a/src/main/java/net/minecraft/server/Container.java
+++ b/src/main/java/net/minecraft/server/Container.java
@@ -230,8 +230,12 @@ public abstract class Container {
                 if (i == -999) {
                     if (playerinventory.getCarried() != null) {
                         if (j == 0) {
-                            entityhuman.drop(playerinventory.getCarried(), true);
+                            // Paper start - Backport an event fix - SPIGOT-2806
+                            //entityhuman.drop(playerinventory.getCarried(), true);
+                            ItemStack carried = playerinventory.getCarried();
                             playerinventory.setCarried((ItemStack) null);
+                            entityhuman.drop(carried, true);
+                            // Paper end
                         }
 
                         if (j == 1) {
-- 
2.10.2

